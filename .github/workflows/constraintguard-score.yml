# ConstraintGuard â€” Score pre-existing SARIF
#
# This workflow scores SARIF findings output by any analyzer.
# Copy or adapt this file into your embedded C/C++ project.
#
# Usage:
#   1. Place your .constraintguard.yml in the repo root (or adjust config-path).
#   2. Place SARIF file(s) in the repo, or generate them in a prior step.
#   3. This action will score findings, post a PR comment, and optionally fail
#      the build if any finding reaches the configured severity threshold.

name: ConstraintGuard (Score SARIF)

on:
  pull_request:
    branches: [main]

permissions:
  contents: read
  pull-requests: write

jobs:
  constraintguard:
    name: Score findings
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # If your SARIF is generated by a prior step (e.g., Clang, CodeQL export),
      # generate it here. Otherwise, point sarif-path at a checked-in file.

      - name: Run ConstraintGuard
        uses: SrOscuroBlck/ConstraintGuard@main
        with:
          mode: score
          sarif-path: "path/to/results.sarif"     # <-- adjust to your SARIF location
          config-path: ".constraintguard.yml"
          fail-on: "critical"                      # fail the PR if any CRITICAL finding
          top-k: "5"
          comment-on-pr: "true"
